<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembagian Hasil Keuangan</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon_io/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
</head>
<body class="bg-gray-100 dark:bg-gray-900">
    <div class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar -->
        <aside class="md:flex hidden flex-col w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700">
            <div class="flex flex-col flex-1 p-4">
                <!-- Logo -->
                <div class="flex items-center mb-8">
                    <span class="ml-3 text-xl font-bold text-gray-800 dark:text-white">Menu</span>
                </div>
                <!-- Menu Items -->
                <nav class="space-y-2 md:mb-0 mb-64">
                    <a href="index.html" class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-blue-100 hover:dark:bg-blue-900">
                        <i class="fas fa-home w-6"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="members.html" class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900">
                        <i class="fas fa-users w-6"></i>
                        <span>Anggota</span>
                    </a>
                    <a href="history.html" class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-blue-100 hover:dark:bg-blue-900">
                        <i class="fas fa-clock w-6"></i>
                        <span>Riwayat</span>
                    </a>
                    <a href="withdraw.html" class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900">
                        <i class="fas fa-hand-holding-usd w-6"></i>
                        <span>Ambil</span>
                    </a>
                    <a class="flex items-center p-3 text-gray-700 dark:text-gray-200 rounded-lg bg-blue-100 dark:bg-blue-900">
                        <i class="fas fa-balance-scale w-6"></i>
                        <span>Bagi</span>
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-4 space-y-6">
            <!-- Form Total Saldo -->
            <div class="bg-white dark:bg-gray-800 p-4 md:p-6 rounded-lg shadow">
                <h1 class="text-lg md:text-2xl font-bold text-gray-800 dark:text-white mb-4">Pembagian Hasil Keuangan</h1>

                <form class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
                        <!-- Pemasukan -->
                        <div class="relative">
                        <label for="pemasukan" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pemasukan</label>
                        <span class="absolute left-3 top-9 text-gray-500 dark:text-gray-400">Rp</span>
                        <input type="text" id="pemasukan" inputmode="numeric"
                            class="w-full p-3 pl-12 rounded-lg border border-gray-300 dark:border-gray-600 
                            bg-white dark:bg-gray-700 text-gray-900 dark:text-white 
                            focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- Pengeluaran -->
                        <div class="relative">
                        <label for="pengeluaran" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Pengeluaran</label>
                        <span class="absolute left-3 top-9 text-gray-500 dark:text-gray-400">Rp</span>
                        <input type="text" id="pengeluaran" inputmode="numeric"
                            class="w-full p-3 pl-12 rounded-lg border border-gray-300 dark:border-gray-600 
                            bg-white dark:bg-gray-700 text-gray-900 dark:text-white 
                            focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- Total -->
                        <div class="relative">
                        <label for="total" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Total</label>
                        <span class="absolute left-3 top-9 text-gray-500 dark:text-gray-400">Rp</span>
                        <input type="text" id="total" inputmode="numeric" readonly
                            class="w-full p-3 pl-12 rounded-lg border border-gray-300 dark:border-gray-600 
                            bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white 
                            focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- Tombol Hitung -->
                        <div class="flex justify-center md:justify-start">
                        <button type="button" id="hitungBtn"
                            class="w-full md:w-1/2 p-3 rounded-lg bg-blue-500 text-white hover:bg-blue-600 active:bg-blue-700">
                            Hitung
                        </button>
                        </div>
                    </div>
                </form>

            </div>

            <!-- Tabel Pembagian -->
            <div id="receipt-container" class="bg-white dark:bg-gray-800 p-4 md:p-6 rounded-lg shadow">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm md:text-base text-left table-auto border-collapse">
                        <thead>
                            <tr class="bg-gray-200 dark:bg-gray-700">
                                <th class="p-2 md:p-4 text-gray-800 dark:text-gray-200">Nama</th>
                                <th class="p-2 md:p-4 text-gray-800 dark:text-gray-200">Persentase</th>
                                <th class="p-2 md:p-4 text-gray-800 dark:text-gray-200">Didapat</th>
                                <th class="p-2 md:p-4 text-gray-800 dark:text-gray-200">Pengambilan</th>
                                <th class="p-2 md:p-4 text-gray-800 dark:text-gray-200">Hasil</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Table Row -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col md:flex-row gap-4 justify-end">
                <button id="downloadButton" class="w-full md:w-auto px-6 py-3 rounded-lg bg-blue-500 text-white hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700">Save</button>
                <button id="shareButton" class="w-full md:w-auto px-6 py-3 rounded-lg bg-green-500 text-white hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700">Share</button>
            </div>
        </main>
    </div>
    <!-- loading screen -->
    <div id="loading-screen" class="fixed inset-0 hidden items-center justify-center bg-white bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 z-50">
        <!-- Font Awesome Spinner -->
        <i class="fas fa-spinner fa-spin text-blue-500 text-5xl"></i>
    </div>
    <script type="module" src="js/bagi.js" defer></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>

        // Fungsi untuk mengambil screenshot
        async function captureReceipt() {
            const receipt = document.getElementById('receipt-container');
            try {
                const canvas = await html2canvas(receipt, {
                    backgroundColor: null,
                    scale: 2, // Meningkatkan kualitas gambar
                    logging: false,
                    useCORS: true
                });
                return canvas;
            } catch (error) {
                console.error('Error capturing receipt:', error);
                return null;
            }
        }

        // Fungsi untuk berbagi
        async function shareReceipt() {
            try {
                const canvas = await captureReceipt();
                if (!canvas) return;

                canvas.toBlob(async (blob) => {
                    const file = new File([blob], 'bukti-transaksi.png', { type: 'image/png' });
                    
                    // Menggunakan Web Share API
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                files: [file],
                                title: 'Bukti Transaksi nabung.',
                                text: 'Bukti transaksi dari aplikasi nabung.'
                            });
                        } catch (error) {
                            if (error.name !== 'AbortError') {
                                console.error('Error sharing:', error);
                                alert('Gagal membagikan bukti transaksi');
                            }
                        }
                    } else {
                        // Fallback untuk browser yang tidak mendukung Web Share API
                        const shareUrl = canvas.toDataURL('image/png');
                        const a = document.createElement('a');
                        a.href = shareUrl;
                        a.download = 'bukti-transaksi.png';
                        a.click();
                    }
                }, 'image/png');
            } catch (error) {
                console.error('Error in shareReceipt:', error);
                alert('Gagal membagikan bukti transaksi');
            }
        }

        // Fungsi untuk mengunduh
        async function downloadReceipt() {
            try {
                const canvas = await captureReceipt();
                if (!canvas) return;

                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png');
                a.download = 'bukti-transaksi.png';
                a.click();
            } catch (error) {
                console.error('Error downloading receipt:', error);
                alert('Gagal mengunduh bukti transaksi');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('shareButton').addEventListener('click', shareReceipt);
            document.getElementById('downloadButton').addEventListener('click', downloadReceipt);
        });
    </script>
</body>
</html>
